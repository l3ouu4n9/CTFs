#!/usr/bin/env python3

from pwn import *
import base64
import codecs
import morse
import RsaSmallMessage


p = remote("crypto.chal.csaw.io", 5001)

while True:
	try:
		p.recvuntil("What does this mean?\r\n")
	except:
		p.recvline()
		p.recvline()
		print(p.recvline())
		break
		
	message = p.recvline().decode().rstrip()
	#message = "---.. ....- /.---- ----- ..... /-.... ..... /..... --... /--... ...-- /-.... ---.. /-.... ----. /.---- ..--- ..--- /--... ---.. /---.. ....- /-.... ..... /..... ..--- /--... ---.. /---.. ....- /--... --... /.---- ..--- ----- /--... ---.. /---.. ....- /.---- ----- --... /..... ...-- /--... ---.. /.---- ----- -.... /--... --... /..... ----- /--... ----. /-.... ---.. /.---- ----- ...-- /.---- ..--- .---- /--... ---.. /.---- ..--- ..--- /-.... ----. /.---- ..--- .---- /--... --... /.---- ----- -.... /--... ...-- /.---- ..--- .---- /--... ----. /-.... ---.. /.---- ----- --... /..... ...-- /--... ---.. /-.... ---.. /---.. .---- /.---- ..--- .---- /--... --... /.---- ----- -.... /---.. .---- /.---- .---- ----. /--... --... /.---- ..--- ..--- /---.. ----. /..... .---- /--... --... /.---- ----- -.... /.---- ----- ...-- /..... ..--- /--... --... /.---- ..--- ..--- /---.. ..... /..... .---- /--... --... /-.... ---.. /---.. ----. /.---- ..--- .---- /--... --... /---.. ....- /--... ...-- /....- ---.. /--... ----. /---.. ....- /---.. ..... /....- ---.. /--... --... /.---- ..--- ..--- /---.. ----. /.---- ..--- ----- /--... ----. /-.... ---.. /---.. .---- /.---- ..--- ..--- /--... --... /.---- ----- -.... /--... ...-- /.---- ..--- .---- /--... ----. /---.. ....- /---.. ..... /.---- .---- ----. /--... ---.. /.---- ..--- ..--- /--... --... /.---- ..--- .---- /--... --... /.---- ..--- ..--- /---.. ----. /....- ----. /--... ---.. /-.... ---.. /----. ----. /.---- .---- ----. /--... ----. /---.. ....- /.---- ----- ...-- /..... ..--- /--... --... /.---- ----- -.... /.---- ----- --... /..... ----- /--... --... /---.. ....- /---.. .---- /.---- ..--- ----- /--... ---.. /.---- ..--- ..--- /-.... ..... /..... ----- /--... ---.. /.---- ..--- ..--- /---.. .---- /..... ...-- /--... --... /.---- ..--- ..--- /.---- ----- ...-- /..... .---- /--... ---.. /---.. ....- /---.. ..... /..... ----- /--... ---.. /.---- ----- -.... /--... --... /....- ---.. /--... ---.. /.---- ..--- ..--- /---.. ----. /.---- ..--- ..--- /--... ---.. /.---- ..--- ..--- /----. ----. /.---- ..--- ..--- /--... --... /.---- ----- -.... /---.. ..... /.---- ..--- .---- /--... --... /.---- ----- -.... /--... ...-- /..... .---- /--... --... /---.. ....- /---.. ----. /.---- ..--- ..--- /--... ----. /-.... ---.. /--... ...-- /.---- .---- ----. /--... --... /.---- ..--- ..--- /.---- ----- ...-- /.---- .---- ----. /--... ---.. /-.... ---.. /--... ...-- /.---- ..--- ..--- /--... ----. /-.... ---.. /-.... ----. /.---- ..--- .---- /--... ---.. /-.... ---.. /-.... ..... /..... ...-- /--... ---.. /.---- ----- -.... /-.... ..... /..... ..--- /--... ---.. /---.. ....- /--... --... /.---- ..--- ..--- /--... --... /---.. ....- /.---- ----- ...-- /.---- ..--- ..--- /--... ---.. /.---- ----- -.... /.---- ----- ...-- /.---- ..--- .---- /--... --... /-.... ---.. /-.... ----. /..... ----- /--... ---.. /-.... ---.. /---.. ----. /....- ---.. /--... --... /.---- ..--- ..--- /---.. ..... /.---- ..--- ..--- /--... ---.. /-.... ---.. /-.... ..... /....- ----. /--... --... /.---- ..--- ..--- /---.. ..... /..... ..--- /--... --... /---.. ....- /--... --... /..... ...-- /--... --... /---.. ....- /---.. .---- /.---- ..--- .---- /--... --... /.---- ----- -.... /---.. .---- /..... ...-- /--... ---.. /.---- ----- -.... /--... --... /.---- ..--- .---- /--... ----. /---.. ....- /--... ...-- /.---- ..--- ----- /--... ---.. /.---- ..--- ..--- /.---- ----- --... /....- ---.. /--... --... /---.. ....- /.---- ----- ...-- /.---- ..--- .---- /--... ---.. /---.. ....- /.---- ----- ...-- /....- ----. /--... ---.. /---.. ....- /-.... ----. /.---- ..--- ----- /--... ---.. /-.... ---.. /---.. ..... /....- ----. /--... ---.. /---.. ....- /--... --... /....- ---.. /--... ---.. /.---- ----- -.... /.---- ----- ...-- /.---- ..--- .---- /--... ---.. /.---- ----- -.... /--... --... /.---- ..--- ..--- /--... --... /-.... ---.. /.---- ----- --... /....- ---.. /--... ---.. /-.... ---.. /-.... ----. /..... ...-- /--... ---.. /-.... ---.. /-.... ----. /.---- ..--- .---- /--... ----. /-.... ---.. /.---- ----- ...-- /....- ----. /--... ---.. /---.. ....- /---.. ..... /....- ----. /--... --... /---.. ....- /---.. ----. /.---- ..--- .---- /--... ---.. /---.. ....- /--... --... /..... ----- /--... --... /-.... ---.. /-.... ----. /.---- .---- ----. /--... --... /-.... ---.. /.---- ----- ...-- /..... ..--- /--... --... /---.. ....- /----. ----. /..... ----- /--... ---.. /-.... ---.. /---.. .---- /..... .---- /--... ----. /-.... ---.. /-.... ..... /.---- .---- ----. /--... ----. /-.... ---.. /----. ----. /.---- ..--- ..--- /--... ---.. /-.... ---.. /-.... ..... /.---- ..--- ----- /--... ----. /---.. ....- /.---- ----- ...-- /.---- .---- ----. /--... ---.. /.---- ..--- ..--- /---.. ----. /..... ----- /--... --... /---.. ....- /----. ----. /..... ----- /--... --... /.---- ----- -.... /--... --... /..... .---- /--... --... /.---- ..--- ..--- /-.... ..... /.---- ..--- .---- /--... --... /---.. ....- /.---- ----- --... /.---- ..--- .---- /--... ---.. /.---- ----- -.... /-.... ----. /..... ----- /--... ----. /-.... ---.. /--... --... /.---- .---- ----. /--... ----. /---.. ....- /-.... ----. /..... ...-- /--... ---.. /---.. ....- /--... ...-- /....- ----. /--... ---.. /---.. ....- /---.. ----. /....- ---.. /--... ---.. /.---- ..--- ..--- /--... ...-- /.---- ..--- .---- /--... ----. /-.... ---.. /--... --... /..... ...-- /--... ---.. /---.. ....- /---.. .---- /....- ---.. /--... ----. /-.... ---.. /---.. .---- /....- ----. /--... ----. /-.... ---.. /---.. ..... /.---- .---- ----. /--... ----. /-.... ---.. /---.. ..... /.---- ..--- ..--- /--... --... /.---- ..--- ..--- /--... ...-- /..... ...-- /--... ---.. /.---- ..--- ..--- /-.... ..... /.---- ..--- ----- /--... ----. /-.... ---.. /---.. .---- /.---- ..--- ..--- /--... --... /---.. ....- /---.. ----. /....- ---.. /--... --... /.---- ----- -.... /-.... ----. /....- ----. /--... ----. /---.. ....- /-.... ----. /.---- .---- ----. /--... ----. /---.. ....- /--... --... /..... ..--- /--... --... /-.... ---.. /-.... ..... /.---- ..--- ----- /--... --... /---.. .---- /.---- .---- ..--- /.---- ----- ---.. /--... ...-- /-.... ---.. /....- ---.. /.---- ----- ...-- /--... --... /.---- .---- ----. /.---- .---- ..--- /.---- ----- -.... /--... ...-- /-.... ---.. /....- ---.. /.---- ----- ...-- /--... --... /---.. ....- /---.. ..... /.---- ..--- .---- /--... --... /---.. ....- /---.. ----. /..... .---- /--... ---.. /-.... ---.. /--... ...-- /....- ---.. /--... --... /.---- ----- -.... /----. ----. /.---- ..--- ..--- /--... ----. /---.. ....- /----. ----. /..... .---- /--... ---.. /-.... ---.. /--... --... /..... ----- /--... ---.. /.---- ..--- ..--- /-.... ..... /.---- ..--- .---- /--... ----. /-.... ---.. /.---- ----- --... /.---- .---- ----. /--... --... /.---- ----- -.... /----. ----. /.---- ..--- ..--- /--... --... /.---- ----- -.... /----. ----. /....- ---.. /--... ---.. /---.. ....- /-.... ..... /.---- ..--- ----- /--... ---.. /.---- ..--- ..--- /--... --... /....- ---.. /--... --... /-.... ---.. /-.... ----. /.---- ..--- .---- /--... ---.. /.---- ..--- ..--- /---.. ----. /....- ----. /--... ----. /-.... ---.. /.---- ----- ...-- /.---- ..--- .---- /--... ---.. /-.... ---.. /.---- ----- ...-- /..... .---- /--... --... /-.... ---.. /-.... ..... /..... ..--- /--... --... /.---- ..--- ..--- /--... --... /..... ..--- /--... ----. /---.. ....- /----. ----. /.---- ..--- ..--- /--... --... /.---- ----- -.... /--... --... /.---- ..--- .---- /--... ---.. /---.. ....- /-.... ..... /.---- ..--- .---- /--... --... /---.. ....- /----. ----. /.---- .---- ----. /--... --... /.---- ..--- ..--- /---.. ..... /..... ----- /--... --... /.---- ..--- ..--- /----. ----. /....- ----. /--... --... /---.. ....- /---.. .---- /..... ..--- /--... ----. /-.... ---.. /-.... ----. /..... ..--- /--... ---.. /.---- ----- -.... /-.... ..... /..... ...-- /--... ---.. /.---- ----- -.... /--... ...-- /.---- ..--- ----- /--... ----. /-.... ---.. /---.. ----. /.---- ..--- ..--- /--... ----. /---.. ....- /----. ----. /....- ----. /--... --... /.---- ----- -.... /---.. ..... /..... -----"

	plain = morse.start(message)
	#print(plain)

	base64_data = ''.join([chr(int(data, 10)) for data in plain.split(" ")])
	plain = base64.b64decode(base64_data).decode()
	tmp = plain.split("\n")
	n = int(tmp[0].split('= ')[1])
	e = int(tmp[1].split('= ')[1])
	c = int(tmp[2].split('= ')[1])

	print("N", n)
	print("e", e)
	print("c", c)


	passphrase = RsaSmallMessage.start(n, e, c).decode()
	print("Passphrase: ", passphrase)
	plaintext = codecs.decode(passphrase, 'rot_13')
	print("Plaintext: ", plaintext)

	p.sendline(plaintext)

p.close()
